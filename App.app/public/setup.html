<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEO SUSHI - Database Setup</title>
    <meta name="theme-color" content="#0b0b0c">
    <link rel="icon" href="assets/logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0b0b0c 0%, #1a1a1c 100%);
            color: #fff;
            min-height: 100vh;
            padding: 40px 20px;
        }
        .setup-container {
            max-width: 900px;
            margin: 0 auto;
            background: linear-gradient(145deg, #121214, #0f0f11);
            border: 1px solid rgba(229,207,142,.2);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,.6);
        }
        .setup-header {
            text-align: center;
            margin-bottom: 40px;
        }
        .setup-header h1 {
            font-family: "Playfair Display", serif;
            font-size: 36px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #fff 0%, #e5cf8e 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .setup-header p {
            color: rgba(255,255,255,.7);
            font-size: 16px;
        }
        .setup-step {
            background: rgba(255,255,255,.03);
            border: 1px solid rgba(229,207,142,.1);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
        }
        .setup-step h3 {
            color: #e5cf8e;
            font-size: 20px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .setup-step p {
            color: rgba(255,255,255,.8);
            line-height: 1.6;
            margin-bottom: 16px;
        }
        .setup-step ol, .setup-step ul {
            color: rgba(255,255,255,.8);
            margin-left: 20px;
            line-height: 1.8;
        }
        .setup-step li {
            margin-bottom: 8px;
        }
        .setup-step code {
            background: rgba(0,0,0,.3);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        .setup-step a {
            color: #e5cf8e;
            text-decoration: none;
            border-bottom: 1px solid rgba(229,207,142,.3);
        }
        .setup-step a:hover {
            border-bottom-color: #e5cf8e;
        }
        .config-form {
            margin-top: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            color: rgba(255,255,255,.9);
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .form-group input {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255,255,255,.05);
            border: 1px solid rgba(229,207,142,.2);
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
            font-family: 'Courier New', monospace;
        }
        .form-group input:focus {
            outline: none;
            border-color: #e5cf8e;
            background: rgba(255,255,255,.08);
        }
        .form-group small {
            display: block;
            color: rgba(255,255,255,.5);
            font-size: 12px;
            margin-top: 6px;
        }
        .btn {
            padding: 14px 28px;
            background: linear-gradient(135deg, #c2a355, #e5cf8e);
            border: none;
            border-radius: 8px;
            color: #1a1a1a;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all .3s;
            width: 100%;
            margin-top: 10px;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(194,163,85,.4);
        }
        .btn:disabled {
            opacity: .5;
            cursor: not-allowed;
        }
        .btn-secondary {
            background: rgba(255,255,255,.1);
            color: #fff;
            margin-top: 10px;
        }
        .btn-secondary:hover {
            background: rgba(255,255,255,.15);
        }
        .status-message {
            padding: 16px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }
        .status-message.success {
            background: rgba(16,185,129,.1);
            border: 1px solid rgba(16,185,129,.3);
            color: #10b981;
            display: block;
        }
        .status-message.error {
            background: rgba(239,68,68,.1);
            border: 1px solid rgba(239,68,68,.3);
            color: #ef4444;
            display: block;
        }
        .status-message.info {
            background: rgba(59,130,246,.1);
            border: 1px solid rgba(59,130,246,.3);
            color: #3b82f6;
            display: block;
        }
        .code-block {
            background: rgba(0,0,0,.3);
            border: 1px solid rgba(229,207,142,.2);
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            overflow-x: auto;
        }
        .code-block code {
            color: #e5cf8e;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            white-space: pre;
        }
        .warning-box {
            background: rgba(239,68,68,.1);
            border: 1px solid rgba(239,68,68,.3);
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        .warning-box strong {
            color: #ef4444;
            display: block;
            margin-bottom: 8px;
        }
        .info-box {
            background: rgba(229,207,142,.1);
            border: 1px solid rgba(229,207,142,.2);
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        .info-box strong {
            color: #e5cf8e;
            display: block;
            margin-bottom: 8px;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(229,207,142,.2);
        }
        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: rgba(255,255,255,.6);
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            border-bottom: 2px solid transparent;
            transition: all .3s;
        }
        .tab.active {
            color: #e5cf8e;
            border-bottom-color: #e5cf8e;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="setup-container">
        <div class="setup-header">
            <h1>‚öôÔ∏è Database Setup</h1>
            <p>Thi·∫øt l·∫≠p MySQL Database cho LEO SUSHI</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('auto')">üöÄ T·ª± ƒê·ªông</button>
            <button class="tab" onclick="showTab('manual')">üìù Th·ªß C√¥ng</button>
            <button class="tab" onclick="showTab('config')">‚öôÔ∏è C·∫•u H√¨nh</button>
        </div>

        <!-- Tab 1: Auto Setup -->
        <div id="tab-auto" class="tab-content active">
        <div class="setup-step">
                <h3>üöÄ Setup Database</h3>
                <p><strong>C√°ch ƒë∆°n gi·∫£n nh·∫•t:</strong> M·ªü file <code>database/setup.php</code> trong browser</p>
                
                <div class="info-box" style="background: rgba(16,185,129,.1); border-color: rgba(16,185,129,.3); margin-top: 20px;">
                    <strong>‚úÖ H∆Ø·ªöNG D·∫™N:</strong>
                    <ol style="margin-left: 20px; margin-top: 8px;">
                        <li><strong>ƒê·∫£m b·∫£o XAMPP ƒëang ch·∫°y</strong> (Apache v√† MySQL)</li>
                        <li><strong>M·ªü browser</strong> v√† truy c·∫≠p: <code>http://localhost/leosushi/database/setup.php</code></li>
                        <li><strong>ƒêi·ªÅn th√¥ng tin MySQL:</strong>
                            <ul style="margin-left: 20px; margin-top: 4px;">
                                <li>MySQL Host: <code>localhost</code></li>
                                <li>MySQL User: <code>root</code></li>
                                <li>MySQL Password: ƒê·ªÉ tr·ªëng (ho·∫∑c nh·∫≠p n·∫øu c√≥)</li>
                                <li>Database Name: <code>leosushi</code></li>
                    </ul>
                </li>
                        <li><strong>Click "T·∫°o Database"</strong></li>
                        <li>Xong! Database ƒë√£ ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông</li>
                    </ol>
                </div>

                <div class="info-box" style="margin-top: 24px;">
                    <strong>‚ú® Script s·∫Ω t·ª± ƒë·ªông:</strong>
                    <ul style="margin-left: 20px; margin-top: 8px;">
                        <li>‚úÖ T·∫°o database <code>leosushi</code></li>
                        <li>‚úÖ Import schema (10 b·∫£ng)</li>
                        <li>‚úÖ Generate v√† import menu data</li>
                        <li>‚úÖ Hi·ªÉn th·ªã th·ªëng k√™ d·ªØ li·ªáu</li>
            </ul>
                </div>

                <div class="warning-box" style="margin-top: 20px;">
                    <strong>‚ö†Ô∏è Y√™u c·∫ßu:</strong>
                    <ul style="margin-left: 20px; margin-top: 8px;">
                        <li>MySQL Server ƒëang ch·∫°y (XAMPP MySQL ho·∫∑c MySQL ri√™ng)</li>
                        <li>Node.js ƒë√£ ƒë∆∞·ª£c c√†i ƒë·∫∑t</li>
                        <li>Quy·ªÅn t·∫°o database trong MySQL</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Tab 2: Manual Setup -->
        <div id="tab-manual" class="tab-content">
        <div class="setup-step">
                <h3>üìù Setup Th·ªß C√¥ng</h3>
                <p>N·∫øu b·∫°n mu·ªën setup t·ª´ng b∆∞·ªõc th·ªß c√¥ng:</p>

                <h4 style="color: #e5cf8e; margin-top: 24px; margin-bottom: 12px;">B∆∞·ªõc 1: C√†i ƒë·∫∑t MySQL</h4>
                <ul style="margin-left: 20px;">
                    <li><strong>Windows:</strong> T·∫£i t·ª´ <a href="https://dev.mysql.com/downloads/installer/" target="_blank">MySQL Installer</a></li>
                    <li><strong>macOS:</strong> <code>brew install mysql && brew services start mysql</code></li>
                    <li><strong>Linux:</strong> <code>sudo apt install mysql-server</code></li>
                </ul>

                <h4 style="color: #e5cf8e; margin-top: 24px; margin-bottom: 12px;">B∆∞·ªõc 2: T·∫°o Database v√† Schema</h4>
                <div class="code-block">
                    <code>mysql -u root -p < database/schema.sql</code>
                </div>
                <p style="margin-top: 8px;">Nh·∫≠p m·∫≠t kh·∫©u MySQL khi ƒë∆∞·ª£c h·ªèi.</p>

                <h4 style="color: #e5cf8e; margin-top: 24px; margin-bottom: 12px;">B∆∞·ªõc 3: Generate v√† Import Menu Data</h4>
            <div class="code-block">
                    <code>cd database
node generate-menu-data.js
mysql -u root -p leosushi < menu-data-import.sql</code>
                </div>

                <h4 style="color: #e5cf8e; margin-top: 24px; margin-bottom: 12px;">B∆∞·ªõc 4: C·∫•u h√¨nh Backend</h4>
                <p>T·∫°o file <code>backend/.env</code> (xem tab "C·∫•u H√¨nh")</p>

                <div class="info-box" style="margin-top: 20px;">
                    <strong>üìñ Xem th√™m:</strong>
                    <p style="margin: 0; margin-top: 8px;">H∆∞·ªõng d·∫´n chi ti·∫øt t·∫°i: <code>database/SETUP_DATABASE.md</code></p>
            </div>
            </div>
        </div>

        <!-- Tab 3: Config -->
        <div id="tab-config" class="tab-content">
        <div class="setup-step">
                <h3>‚öôÔ∏è C·∫•u H√¨nh Backend</h3>
                <p>T·∫°o file <code>backend/.env</code> ƒë·ªÉ c·∫•u h√¨nh k·∫øt n·ªëi database v√† c√°c th√¥ng s·ªë kh√°c.</p>

                <form class="config-form" id="configForm" onsubmit="generateEnvFile(event); return false;">
                    <h4 style="color: #e5cf8e; margin-bottom: 16px;">Database Configuration</h4>
                    
                    <div class="form-group">
                        <label for="dbHost">DB Host *</label>
                        <input type="text" id="dbHost" required placeholder="localhost" value="localhost">
                        <small>ƒê·ªãa ch·ªâ MySQL server</small>
            </div>
            
                <div class="form-group">
                        <label for="dbUser">DB User *</label>
                        <input type="text" id="dbUser" required placeholder="root" value="root">
                        <small>Username MySQL</small>
                </div>

                <div class="form-group">
                        <label for="dbPassword">DB Password *</label>
                        <input type="password" id="dbPassword" required placeholder="Nh·∫≠p m·∫≠t kh·∫©u MySQL">
                        <small>M·∫≠t kh·∫©u MySQL c·ªßa b·∫°n</small>
                </div>

                <div class="form-group">
                        <label for="dbName">DB Name *</label>
                        <input type="text" id="dbName" required placeholder="leosushi" value="leosushi">
                        <small>T√™n database</small>
                    </div>

                    <h4 style="color: #e5cf8e; margin-top: 32px; margin-bottom: 16px;">Server Configuration</h4>

                    <div class="form-group">
                        <label for="port">Port *</label>
                        <input type="number" id="port" required placeholder="3000" value="3000">
                        <small>Port cho backend server</small>
                </div>

                <div class="form-group">
                        <label for="corsOrigin">CORS Origin *</label>
                        <input type="text" id="corsOrigin" required placeholder="http://localhost:5500" value="http://localhost:5500">
                        <small>URL frontend (ƒë·ªÉ CORS ho·∫°t ƒë·ªông)</small>
                </div>

                <div class="form-group">
                        <label for="frontendUrl">Frontend URL *</label>
                        <input type="text" id="frontendUrl" required placeholder="http://localhost:5500" value="http://localhost:5500">
                        <small>URL frontend (cho email links)</small>
                    </div>

                    <h4 style="color: #e5cf8e; margin-top: 32px; margin-bottom: 16px;">JWT Configuration</h4>

                    <div class="form-group">
                        <label for="jwtSecret">JWT Secret *</label>
                        <input type="text" id="jwtSecret" required placeholder="T·∫°o key ng·∫´u nhi√™n (√≠t nh·∫•t 32 k√Ω t·ª±)">
                        <small>Secret key cho JWT token (d√πng: <code>openssl rand -base64 32</code> ƒë·ªÉ t·∫°o)</small>
                </div>

                <div class="form-group">
                        <label for="jwtExpiresIn">JWT Expires In</label>
                        <input type="text" id="jwtExpiresIn" placeholder="7d" value="7d">
                        <small>Th·ªùi gian h·∫øt h·∫°n token (v√≠ d·ª•: 7d, 24h, 1h)</small>
                    </div>

                    <h4 style="color: #e5cf8e; margin-top: 32px; margin-bottom: 16px;">Email Configuration</h4>

                    <div class="form-group">
                        <label for="resendApiKey">Resend API Key</label>
                        <input type="text" id="resendApiKey" placeholder="re_...">
                        <small>API key t·ª´ Resend (ƒë·ªÉ g·ª≠i email)</small>
                </div>

                    <button type="submit" class="btn">üíæ T·∫°o File .env</button>
                    <button type="button" class="btn btn-secondary" onclick="loadExistingConfig()">üì• Load Config Hi·ªán T·∫°i</button>
            </form>

            <div id="statusMessage" class="status-message"></div>

                <div class="info-box" style="margin-top: 24px;">
                    <strong>üìù H∆∞·ªõng d·∫´n:</strong>
                    <ol style="margin-left: 20px; margin-top: 8px;">
                        <li>ƒêi·ªÅn th√¥ng tin v√†o form tr√™n</li>
                        <li>Click "T·∫°o File .env"</li>
                        <li>File s·∫Ω ƒë∆∞·ª£c t·∫£i v·ªÅ t·ª± ƒë·ªông</li>
                        <li>Copy file v√†o th∆∞ m·ª•c <code>backend/</code></li>
                        <li>ƒê·ªïi t√™n th√†nh <code>.env</code> (b·ªè ph·∫ßn .txt n·∫øu c√≥)</li>
                    </ol>
        </div>

                <div class="warning-box" style="margin-top: 20px;">
                    <strong>‚ö†Ô∏è L∆∞u √Ω b·∫£o m·∫≠t:</strong>
                    <ul style="margin-left: 20px; margin-top: 8px;">
                        <li>KH√îNG commit file <code>.env</code> v√†o Git</li>
                        <li>Gi·ªØ file <code>.env</code> b√≠ m·∫≠t</li>
                        <li>Thay ƒë·ªïi JWT_SECRET trong production</li>
                </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(`tab-${tabName}`).classList.add('active');
            event.target.classList.add('active');
        }

        function generateEnvFile(event) {
            event.preventDefault();
            
            const config = {
                DB_HOST: document.getElementById('dbHost').value.trim(),
                DB_USER: document.getElementById('dbUser').value.trim(),
                DB_PASSWORD: document.getElementById('dbPassword').value.trim(),
                DB_NAME: document.getElementById('dbName').value.trim(),
                PORT: document.getElementById('port').value.trim(),
                CORS_ORIGIN: document.getElementById('corsOrigin').value.trim(),
                FRONTEND_URL: document.getElementById('frontendUrl').value.trim(),
                JWT_SECRET: document.getElementById('jwtSecret').value.trim(),
                JWT_EXPIRES_IN: document.getElementById('jwtExpiresIn').value.trim() || '7d',
                RESEND_API_KEY: document.getElementById('resendApiKey').value.trim() || ''
            };

            // Validate required fields
            if (!config.DB_HOST || !config.DB_USER || !config.DB_PASSWORD || !config.DB_NAME || 
                !config.PORT || !config.CORS_ORIGIN || !config.FRONTEND_URL || !config.JWT_SECRET) {
                showStatus('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß c√°c tr∆∞·ªùng b·∫Øt bu·ªôc!', 'error');
                return;
            }

            // Generate .env content
            let envContent = `# ============================================
# Database Configuration
# ============================================
DB_HOST=${config.DB_HOST}
DB_USER=${config.DB_USER}
DB_PASSWORD=${config.DB_PASSWORD}
DB_NAME=${config.DB_NAME}

# ============================================
# Server Configuration
# ============================================
PORT=${config.PORT}
CORS_ORIGIN=${config.CORS_ORIGIN}
FRONTEND_URL=${config.FRONTEND_URL}

# ============================================
# JWT Authentication Configuration
# ============================================
JWT_SECRET=${config.JWT_SECRET}
JWT_EXPIRES_IN=${config.JWT_EXPIRES_IN}

# ============================================
# Email Configuration (Resend API)
# ============================================
RESEND_API_KEY=${config.RESEND_API_KEY}
`;

            // Download file
            const blob = new Blob([envContent], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
            a.download = '.env';
                a.click();
                URL.revokeObjectURL(url);

            // Save to localStorage as backup
            localStorage.setItem('env_config_backup', JSON.stringify(config));

            showStatus('‚úÖ ƒê√£ t·∫°o file .env! Vui l√≤ng copy file v√†o th∆∞ m·ª•c backend/ v√† ƒë·ªïi t√™n th√†nh .env', 'success');
        }

        function loadExistingConfig() {
            try {
                const backup = localStorage.getItem('env_config_backup');
                if (backup) {
                    const config = JSON.parse(backup);
                    document.getElementById('dbHost').value = config.DB_HOST || 'localhost';
                    document.getElementById('dbUser').value = config.DB_USER || 'root';
                    document.getElementById('dbPassword').value = config.DB_PASSWORD || '';
                    document.getElementById('dbName').value = config.DB_NAME || 'leosushi';
                    document.getElementById('port').value = config.PORT || '3000';
                    document.getElementById('corsOrigin').value = config.CORS_ORIGIN || 'http://localhost:5500';
                    document.getElementById('frontendUrl').value = config.FRONTEND_URL || 'http://localhost:5500';
                    document.getElementById('jwtSecret').value = config.JWT_SECRET || '';
                    document.getElementById('jwtExpiresIn').value = config.JWT_EXPIRES_IN || '7d';
                    document.getElementById('resendApiKey').value = config.RESEND_API_KEY || '';
                    showStatus('‚úÖ ƒê√£ load config t·ª´ backup!', 'info');
                } else {
                    showStatus('Kh√¥ng t√¨m th·∫•y config backup. Vui l√≤ng ƒëi·ªÅn th√¥ng tin m·ªõi.', 'info');
                }
            } catch (e) {
                showStatus('L·ªói khi load config: ' + e.message, 'error');
            }
        }

        async function checkBackend() {
            const apiBaseUrl = document.getElementById('apiBaseUrl').value.trim();
            const checkBtn = document.getElementById('checkBackendBtn');
            
            if (!apiBaseUrl) {
                showSetupStatus('Vui l√≤ng nh·∫≠p Backend API URL tr∆∞·ªõc!', 'error');
                return;
            }
            
            checkBtn.disabled = true;
            checkBtn.textContent = '‚è≥ ƒêang ki·ªÉm tra...';
            
            showSetupStatus('üîÑ ƒêang ki·ªÉm tra k·∫øt n·ªëi ƒë·∫øn backend...', 'info');
            
            try {
                const response = await fetch(`${apiBaseUrl}/api/health`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    showSetupStatus(
                        `‚úÖ Backend ƒëang ch·∫°y!\n\n` +
                        `üìç URL: ${apiBaseUrl}\n` +
                        `üìä Status: ${data.status}\n` +
                        `üí¨ Message: ${data.message}\n\n` +
                        `B·∫°n c√≥ th·ªÉ ti·∫øp t·ª•c setup database!`,
                        'success'
                    );
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                console.error('Backend check error:', error);
                showSetupStatus(
                    `‚ùå Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn backend!\n\n` +
                    `üîç URL ƒë√£ ki·ªÉm tra: ${apiBaseUrl}\n\n` +
                    `üìã C√°c b∆∞·ªõc kh·∫Øc ph·ª•c:\n` +
                    `1. M·ªü terminal/PowerShell\n` +
                    `2. Ch·∫°y: cd backend\n` +
                    `3. Ch·∫°y: npm install (n·∫øu ch∆∞a c√†i)\n` +
                    `4. Ch·∫°y: npm start\n` +
                    `5. ƒê·ª£i th·∫•y: "üöÄ LEO SUSHI Backend API running on port 3000"\n` +
                    `6. Click "Ki·ªÉm Tra Backend" l·∫°i\n\n` +
                    `üí° Ho·∫∑c m·ªü ${apiBaseUrl}/api/health trong browser ƒë·ªÉ ki·ªÉm tra`,
                    'error'
                );
            } finally {
                checkBtn.disabled = false;
                checkBtn.textContent = 'üîç Ki·ªÉm Tra Backend';
            }
        }

        function loadSetupConfig() {
            try {
                const backup = localStorage.getItem('env_config_backup');
                if (backup) {
                    const config = JSON.parse(backup);
                    document.getElementById('setupDbHost').value = config.DB_HOST || 'localhost';
                    document.getElementById('setupDbUser').value = config.DB_USER || 'root';
                    document.getElementById('setupDbPassword').value = config.DB_PASSWORD || '';
                    document.getElementById('setupDbName').value = config.DB_NAME || 'leosushi';
                    showSetupStatus('‚úÖ ƒê√£ load config t·ª´ backup!', 'info');
                } else {
                    showSetupStatus('Kh√¥ng t√¨m th·∫•y config backup. Vui l√≤ng ƒëi·ªÅn th√¥ng tin m·ªõi.', 'info');
                }
            } catch (e) {
                showSetupStatus('L·ªói khi load config: ' + e.message, 'error');
            }
        }

        async function setupDatabase(event) {
            event.preventDefault();
            
            const dbHost = document.getElementById('setupDbHost').value.trim();
            const dbUser = document.getElementById('setupDbUser').value.trim();
            const dbPassword = document.getElementById('setupDbPassword').value.trim(); // C√≥ th·ªÉ ƒë·ªÉ tr·ªëng
            const dbName = document.getElementById('setupDbName').value.trim();
            const apiBaseUrl = document.getElementById('apiBaseUrl').value.trim();

            if (!dbHost || !dbUser || !dbName || !apiBaseUrl) {
                showSetupStatus('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc!', 'error');
                return;
            }

            const setupBtn = document.getElementById('setupBtn');
            setupBtn.disabled = true;
            setupBtn.textContent = '‚è≥ ƒêang t·∫°o database...';

            showSetupStatus('üîÑ ƒêang k·∫øt n·ªëi v√† t·∫°o database...', 'info');

            try {
                // Ki·ªÉm tra backend server tr∆∞·ªõc
                try {
                    const healthCheck = await fetch(`${apiBaseUrl}/api/health`);
                    if (!healthCheck.ok) {
                        throw new Error('Backend server kh√¥ng ph·∫£n h·ªìi');
                    }
                } catch (healthError) {
                    throw new Error('Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn backend server t·∫°i ' + apiBaseUrl + '. Vui l√≤ng ƒë·∫£m b·∫£o backend ƒëang ch·∫°y!');
                }

                const response = await fetch(`${apiBaseUrl}/api/setup/database`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        dbHost,
                        dbUser,
                        dbPassword,
                        dbName
                    })
                });

                // Ki·ªÉm tra response
                if (!response.ok) {
                    const errorText = await response.text();
                    let errorData;
                    try {
                        errorData = JSON.parse(errorText);
                    } catch (e) {
                        errorData = { message: errorText || 'L·ªói kh√¥ng x√°c ƒë·ªãnh' };
                    }
                    throw new Error(errorData.message || `HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();

                if (data.success) {
                    showSetupStatus(
                        `‚úÖ Database setup th√†nh c√¥ng!\n\n` +
                        `üìä Th·ªëng k√™:\n` +
                        `   - Danh m·ª•c: ${data.data.categories}\n` +
                        `   - M√≥n ƒÉn: ${data.data.items}\n` +
                        `   - T√πy ch·ªçn: ${data.data.options}`,
                        'success'
                    );
                    
                    // Save config to localStorage
                    localStorage.setItem('env_config_backup', JSON.stringify({
                        DB_HOST: dbHost,
                        DB_USER: dbUser,
                        DB_PASSWORD: dbPassword,
                        DB_NAME: dbName
                    }));
                } else {
                    showSetupStatus('‚ùå L·ªói: ' + (data.message || 'Kh√¥ng th·ªÉ t·∫°o database'), 'error');
                }
            } catch (error) {
                console.error('Setup error:', error);
                
                // Ki·ªÉm tra xem c√≥ ph·∫£i l·ªói CORS kh√¥ng
                let errorMessage = '‚ùå L·ªói k·∫øt n·ªëi!\n\n';
                
                if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                    errorMessage += 'üîç C√≥ th·ªÉ backend server ch∆∞a ch·∫°y!\n\n';
                    errorMessage += 'üìã C√°c b∆∞·ªõc ki·ªÉm tra:\n';
                    errorMessage += '1. M·ªü terminal/PowerShell\n';
                    errorMessage += '2. Ch·∫°y l·ªánh: cd backend && npm start\n';
                    errorMessage += '3. ƒê·ª£i th·∫•y d√≤ng: "üöÄ LEO SUSHI Backend API running on port 3000"\n';
                    errorMessage += '4. Th·ª≠ l·∫°i click "T·∫°o Database"\n\n';
                    errorMessage += 'üí° Ho·∫∑c ki·ªÉm tra backend t·∫°i: ' + apiBaseUrl + '/api/health';
                } else {
                    errorMessage += 'Vui l√≤ng ki·ªÉm tra:\n';
                    errorMessage += '1. Backend server ƒëang ch·∫°y t·∫°i: ' + apiBaseUrl + '\n';
                    errorMessage += '2. MySQL server ƒëang ch·∫°y\n';
                    errorMessage += '3. Th√¥ng tin MySQL ƒë√∫ng\n\n';
                    errorMessage += 'Chi ti·∫øt: ' + error.message;
                }
                
                showSetupStatus(errorMessage, 'error');
            } finally {
                setupBtn.disabled = false;
                setupBtn.textContent = 'üöÄ T·∫°o Database';
            }
        }

        function showStatus(message, type) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = 'status-message ' + type;
            
            // Auto hide after 5 seconds for success/info
            if (type === 'success' || type === 'info') {
                setTimeout(() => {
                    statusEl.classList.remove('active');
                }, 5000);
            }
        }

        function showSetupStatus(message, type) {
            const statusEl = document.getElementById('setupStatusMessage');
            statusEl.textContent = message;
            statusEl.className = 'status-message ' + type;
            statusEl.style.whiteSpace = 'pre-line';
            
            // Auto hide after 10 seconds for success/info
            if (type === 'success' || type === 'info') {
                setTimeout(() => {
                    statusEl.textContent = '';
                    statusEl.className = 'status-message';
                }, 10000);
            }
        }

        // Try to load existing config on page load
        window.addEventListener('DOMContentLoaded', () => {
            loadExistingConfig();
            loadSetupConfig();
        });
    </script>
</body>
</html>
